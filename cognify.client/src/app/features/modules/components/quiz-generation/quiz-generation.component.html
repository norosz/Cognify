<h2 mat-dialog-title>AI Quiz Generation</h2>

<div mat-dialog-content>
    <!-- Configuration -->
    <div class="config-container" *ngIf="!loading()">
        <div class="config-row">
            <mat-form-field appearance="outline" class="density-compact">
                <mat-label>Type</mat-label>
                <mat-select [(ngModel)]="selectedType">
                    <mat-option *ngFor="let t of questionTypes" [value]="t">{{t}}</mat-option>
                </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline" class="density-compact count-field">
                <mat-label>Count</mat-label>
                <input matInput type="number" [(ngModel)]="count" min="1" max="10">
            </mat-form-field>

            <button mat-stroked-button (click)="generate()" class="regen-btn">
                <mat-icon>refresh</mat-icon> Regenerate
            </button>
        </div>

        <div class="slider-row">
            <label>Difficulty ({{difficulty}})</label>
            <mat-slider min="1" max="3" step="1" showTickMarks discrete class="flex-slider">
                <input matSliderThumb [(ngModel)]="difficulty">
            </mat-slider>
        </div>
    </div>

    <div *ngIf="loading()" class="loading-container">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Generating Questions...</p>
    </div>

    <div *ngIf="error()" class="error-container">
        <p class="error-text">{{ error() }}</p>
    </div>

    <div *ngIf="!loading() && !error() && questions().length > 0">
        <p class="summary-text">Generated {{ questions().length }} questions.</p>

        <div class="question-list">
            <div class="question-card" *ngFor="let q of questions(); let i = index">
                <div class="question-header">
                    <div class="question-title">Q{{ i + 1 }} ({{ q.type }})</div>
                    <div class="question-preview">
                        {{ q.prompt | slice:0:80 }}<span *ngIf="q.prompt.length > 80">â€¦</span>
                    </div>
                </div>

                <p class="question-prompt">{{ q.prompt }}</p>

                <!-- Multiple Choice / TrueFalse -->
                <div class="options-list" *ngIf="q.options && q.options.length">
                    <div *ngFor="let opt of q.options" class="option-item" [class.correct]="opt === q.correctAnswer">
                        <mat-icon *ngIf="opt === q.correctAnswer">check_circle</mat-icon>
                        <mat-icon *ngIf="opt !== q.correctAnswer">radio_button_unchecked</mat-icon>
                        <span>{{ opt }}</span>
                    </div>
                </div>

                <!-- Matching -->
                <div class="pairs-list" *ngIf="q.pairs && q.pairs.length">
                    <div *ngFor="let pair of q.pairs" class="pair-item">
                        <mat-icon>compare_arrows</mat-icon> {{ pair }}
                    </div>
                </div>

                <!-- OpenText -->
                <div *ngIf="q.type === 'OpenText'" class="open-text-preview">
                    <em>Open text answer expected.</em>
                </div>

                <p class="explanation" *ngIf="q.explanation"><strong>Explanation:</strong> {{ q.explanation }}</p>
            </div>
        </div>
    </div>
</div>

<div mat-dialog-actions align="end">
    <button mat-button (click)="close()">Cancel</button>
    <button mat-flat-button color="primary" [disabled]="loading() || questions().length === 0" (click)="save()">
        Save Quiz
    </button>
</div>