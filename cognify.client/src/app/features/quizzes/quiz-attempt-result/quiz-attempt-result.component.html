<div *ngIf="loading()" class="loading">Loading result...</div>

<div *ngIf="error()" class="error-container">
  <p class="error-text">{{ error() }}</p>
</div>

<ng-container *ngIf="review() as r">
  <div class="result-header">
    <button mat-icon-button routerLink="/quizzes/{{ r.quizId }}" class="back-button">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <div class="result-title">
      <h1>Quiz Result</h1>
      <p>{{ r.createdAt | date:'medium' }}</p>
    </div>
    <button mat-flat-button color="primary" (click)="retakeQuiz()">Retake</button>
    <button mat-stroked-button color="accent" routerLink="/quizzes/{{ r.quizId }}/attempts/{{ r.attemptId }}/review">
      Review
    </button>
  </div>

  <mat-card class="score-card">
    <div class="score-value" [ngClass]="getScoreClass(r.score)">{{ r.score | number:'1.0-0' }}%</div>
    <div class="score-meta">Correct: {{ (r.score / 100) * r.items.length | number:'1.0-0' }} / {{ r.items.length }}</div>
  </mat-card>

  <mat-accordion class="review-accordion">
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>Review</mat-panel-title>
        <mat-panel-description>{{ r.items.length }} questions</mat-panel-description>
      </mat-expansion-panel-header>

      <div class="review-list">
        <div class="review-item" *ngFor="let item of r.items">
          <div class="review-item-header">
            <span class="review-status" [class.good]="item.isCorrect" [class.bad]="item.isCorrect === false">
              {{ item.isCorrect ? 'Correct' : 'Incorrect' }}
            </span>
            <span class="review-type">{{ item.questionType }}</span>
          </div>
          <div class="review-prompt">{{ item.prompt }}</div>
        </div>
      </div>

      <div class="review-actions">
        <button mat-stroked-button color="accent" routerLink="/quizzes/{{ r.quizId }}/attempts/{{ r.attemptId }}/review">
          Open full review
        </button>
      </div>
    </mat-expansion-panel>
  </mat-accordion>
</ng-container>
